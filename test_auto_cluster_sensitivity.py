'''
get number of wrong groups from different theta
'''
import numpy as np
from cclp.data_utils.log_utils import init_log
from configs.iot.cfg_iot import out_path

logger = init_log(out_path + '/mylogs/threshold_sensitivity.log')


slopes_unsw = [[-294.22962493387075, -31.63131959805341, -43.299996954431265, -16.12530522650212, -9.645292737626718, -25.047544024177554, -8.23443635723384, -4.398853337409342, -2.5641638116636862],
[-325.94354553336336, -58.84800163163605, -21.231148674544016, -26.21503105280211, -8.929296908519468, -5.068118952421784, -4.5504333623931785, -3.269646088611559, -2.0305000092413934],
[-116.02573686089147, -52.738546546085615, -35.49964672857445, -17.003733076068386, -24.13589196595146, -11.460082166842426, -8.74827538609766, -15.43606460543684, -12.511710725519151],
[-268.3397709518036, -7.689161361938758, -17.424356937522475, -5.712506352074925, -11.565995214403657, -9.076963153876406, -1.7182572250835477, -11.950256677310591, -10.24651088208713],
[-267.9967606275047, -38.84278078960659, -46.45497047699524, -28.129725558281137, -28.34044468503933, -10.348248982670498, -12.27272173216673, -6.843450968999278, -5.422014634550678],
[-157.8485244387108, -85.59923864498393, -20.736300084071402, -10.88264701156865, -6.451106916105758, -7.869444137724784, -7.412770457131373, -4.418573519818722, -5.219239024319705],
[-238.96399793982823, -7.287505201117995, -6.439983518587596, -8.654945178982047, -9.234891914868598, -3.9243401533834117, -4.657440336528765, -10.026371810772545, -7.5935789879593045],
[-116.54316990584454, -116.81210693343522, -43.94136406295192, -22.1366383339803, -7.536701915266576, -4.165176183654069, -4.8384733351199145, -16.72159331682265, -3.3832487886016196],
[-175.42444649955598, -34.588873963585684, -34.771618392108934, -8.128481665185546, -15.529072762560062, -6.150748772138485, -9.440906956082529, -3.1581812287111717, -4.01902140896793],
[-336.540660309594, -109.46653024415332, -102.22542747752118, -48.205092453920884, -19.42063216861743, -24.367043259955494, -8.714012689700823, -6.784133640737423, -7.220235039712591],
[-161.726624262724, -178.002947003743, -34.772799291628246, -33.924130043637376, -9.30703071385696, -7.132310857355435, -16.116267848455067, -4.685312311766381, -11.22340481613054],
[-361.367092350161, -340.75839158508967, -23.20717393385449, -7.966795023056861, -7.641942873688443, -9.114891472644032, -11.35341260463435, -3.1335566426298698, -2.4917503080762984],
[-274.69619112301143, -311.5733120865011, -58.1582292246419, -38.56807801226924, -16.56487835587083, -26.553972288372265, -9.571479595289759, -6.3491429417370995, -4.682885673504771],
[-312.80230035698025, -289.1769327171865, -130.80388710886854, -96.41876787448521, -44.771884493075305, -21.792675821176857, -8.27450390654218, -13.84668730366954, -5.1382438162443975],
[-269.3297590005636, -297.04757418599, -319.43411353451484, -89.05692492309814, -8.505484267212395, -8.045132024297047, -9.36509500906952, -8.31117508343847, -3.828436039859014],
[-238.47822530781377, -258.0377624143074, -170.55509362656784, -41.502983584167566, -20.917378026046663, -21.927702665584974, -32.698537089659055, -10.468584410559231, -6.743238394050252],
[-238.85017896789532, -304.98930450924195, -198.67719461909888, -46.48983251493212, -44.82504580356789, -60.637609264260334, -26.788124352543775, -26.89575939945081, -19.703967688195746]]

real_cluster_num_unsw = [2,2,2,2,2,2,2,2,2,3,3,3,3,4,4,4,4]

slopes_yt = [
[-297.25696164851104, -17.559462211837, -31.055701111648105, -10.783799108883755, -19.81399771502332, -6.649345446960368, -5.13917899281514, -5.953891220228265, -5.47088423928367],
[-274.8222852372992, -58.15780256678977, -15.470705749967166, -17.910111461863778, -8.503872917236222, -7.436520717372019, -6.022265727958839, -7.850719927390443, -2.9299118080458726],
[-197.44875884684268, -159.1380578922132, -100.69701554828458, -9.976026656516908, -6.58306687118607, -10.145388170397922, -4.347180540219995, -6.234247747674985, -2.0877841006917066],
[-97.6554298866698, -7.399900457051714, -5.248909282932743, -5.829632739436711, -5.168364749317796, -2.9897066119134905, -9.594100918625823, -10.100447201269358, -2.007643968936762], # (6,7)
[-179.63316767673177, -37.284321710919755, -25.706110848277007, -10.145549181411894, -5.261384063109006, -5.592300961478557, -7.800958922740236, -3.348776969785334, -3.365888718215558], # (8,9)
[-188.18136821214492, -50.032971409417684, -21.673171748867446, -30.9756975691254, -10.475142494831033, -19.22773230450815, -10.556035099809108, -6.757875349283481, -4.578389521422196], # (10,11)
[-136.79169773624673, -44.39741096887917, -23.545714375116404, -28.251017242242938, -23.221834703797285, -7.665779864821204, -8.102200855504407, -6.200737502702879, -10.812424257268788], # (12,13)
# [-24.702922161096296, -10.905856474418954, -11.150115101202559, -6.795538048872203, -11.095638056377354, -6.295778194042526, -6.889135454716794, -1.9963995419155225, -2.4150180382733453], # (14,15)
[-54.27114795093064, -42.32263199717994, -28.39163993937592, -24.76110423605064, -17.024723156492882, -10.349275371189833, -13.902019358477503, -11.627049549114531, -9.934359768826397],
[-181.40923608815183, -62.59988682370388, -19.26856905731509, -8.411693758692763, -13.130492843291677, -3.867143256348186, -13.787170225055519, -5.960388042248638, -5.2351944900904215],
[-327.0654017146692, -23.19284561817419, -10.814799925177816, -6.176188516012552, -2.9198854226844517, -4.678985551467008, -5.101018053942283, -5.187176530416146, -1.7930066309471897],
[-86.64087598013938, -54.00738983969981, -27.414511603184366, -20.472667065571613, 3.263245819943137, -21.05706060968849, -13.275350988124487, -8.930250124453138, -5.372165079548864],
[-211.34842378992525, -6.642005651288258, -13.752842192472983, -9.954153235595555, 3.593704682837668, -14.329116395388397, -6.257532884231168, -3.357421614276859, -4.673886531237727], 
[-349.9257556659964, -42.40894448882008, -33.22156346460707, -13.877174671438127, -8.048821632486238, -8.695354967144752, -15.364801178933092, -6.147115999525866, -5.888335383651324],
[-424.954147701947, -17.328008547756497, -23.06614644985588, -17.454683988951217, -17.51771426071457, -14.669507474544204, -5.687671748057362, -8.548664351891219, -4.897244285585174],
[-217.90563402119835, -46.18641172064274, -24.089844929031237, -8.73671857575875, -9.360165509537758, -4.236246204300329, -2.8044332783108317, -1.679443047779607, -1.4384766902693826],
[-101.08732264988089, -42.07485525732308, -12.188769107301695, -8.374171909629922, -5.639562862586921, -6.558305744417183, -3.384702477276356, -7.669980852189504, -4.672050748595474],
[-142.99260078583478, -40.11293576489845, -20.335777446682698, -45.692150363757435, -13.070112014510585, -7.551065470413221, -6.7015406794947125, -7.042749653882936, -4.5952877816388025],
[-340.85487628907276, -33.889327479575115, -42.27512394858657, -30.91489748077617, -5.127367275559813, -7.802774343600362, -3.2426194211447523, -2.2587629431067455, -3.5730793406419608],
[-197.9674688281042, -35.331093112659914, -21.073551949994368, -42.918117431270275, -17.507420994395687, -12.958869261834195, -8.581832180050895, -7.978297049980171, -9.666598425586713],
[-70.42753195535741, -26.86955335997328, -17.657262269057156, -35.10200559565487, -6.2817976652213545, -3.8884856153959504, -3.239649297833317, -4.416055104941819, -4.240267931419581],
[-314.73817473517664, -292.5413159072825, -55.45603827447937, -45.388685081047726, -12.385215525142613, -11.77117290205399, -7.048383665513285, -4.319097484373103, -9.93907391000564],
[-280.32483985578693, -116.88797211212756, -21.251037721910564, -7.871790602405213, -10.860710727607028, -9.09673121046842, -6.20195219588031, -9.09673121046842, -3.078826780617405],
[-290.3366931411673, -195.24219034951875, -63.896435178718264, -38.6587809592329, -26.5393573457348, -22.489303173935866, -14.360807534755224, -32.05353888278921, -12.977300426089357],
[-357.21944056451696, -354.18883113351615, -64.80480399013203, -24.45840118043847, -18.567629755650955, -37.41761209593801, -11.957131550679193, -3.729440703760119, -2.732538628193197],
[-264.4843742051336, -238.95968650211955, -241.64011337833216, -57.352050779530146, -50.45461609079564, -48.617198683862966, -11.797156641931053, -10.511532220014061, -11.738043604093747],
[-360.5695761423823, -265.8862479710865, -309.7225091384733, -48.60453837812463, -27.55547440773833, -12.580451561026223, -40.99250194795914, -36.74912123688543, -9.963711970768884],
[-416.633037431287, -431.9839532197515, -267.0133846693503, -26.752694521881736, -37.7606328651069, -10.2799700402215, -6.222752328630577, -5.969727356538286, -3.2313878837534347],
[-162.86241464915213, -148.0824027771008, -148.39724544246087, -44.457513657393406, -58.3568206725713, -32.90121005609626, -40.31601847473314, -28.006041806728717, -28.825997808517855]

]


real_cluster_num_yt = [2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,4,4,4,4]


def obtain_wrong_num(cluster_num_real, slopes_all, threshold):
    '''the first ele whose value is bigger than the threshold'''
    # threshold = -100
    cluster_num_estimate = []
    
    for slopes in slopes_all:
        res = 1
        for idx, slope in enumerate(slopes):
            if slope < threshold and slopes[idx+1] > threshold:
                res = idx + 2
        cluster_num_estimate.append(res)

    wrong_num = [1 for i,j in zip(cluster_num_real,cluster_num_estimate) if i!=j]
    return np.sum(wrong_num)

def main():
    logger.info('unsw')
    theta_unsw = -115.9
    interval = 2
    thetas = [theta_unsw - i*interval for i in range(-4,5)]
    for theta in thetas:
        wrong_group = obtain_wrong_num(real_cluster_num_unsw,slopes_unsw,theta)
        logger.info(f'theta:{theta},wrong_group_num:{wrong_group}')

    logger.info('yt')
    theta_yt = -97.53
    interval = 2
    thetas = [theta_yt - i*interval for i in range(-4,5)]
    for theta in thetas:
        wrong_group = obtain_wrong_num(real_cluster_num_yt,slopes_yt,theta)
        logger.info(f'theta:{theta},wrong_group_num:{wrong_group}')

if __name__ == '__main__':
    main()







